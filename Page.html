<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR Code Styling</title>
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
</head>
<body>
<div id="canvas"></div>
<script type="text/javascript">
    // Assuming `data` is an array containing values for column B
    const data = ["Item1", "Item2", "Item3"]; // Replace with your actual data

    // Loop through the data and generate QR codes
    data.forEach(generateQRCode);

    function generateQRCode(item) {
        const qrCode = new QRCodeStyling({
            width: 300,
            height: 300,
            type: "svg",
            data: item,
            image: "https://i.ibb.co/ZzBFw8k/birb.png",
            dotsOptions: {
                color: "#2575e1",
                type: "rounded"
            },
            backgroundOptions: {
                color: "#ffffff",
            },
            imageOptions: {
                crossOrigin: "anonymous",
                margin: 10
            }
        });

        // Create a container for each QR code
        const container = document.createElement("div");
        container.appendChild(document.createTextNode("Item: " + item)); // Display item information
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        // Append the QR code to the container
        qrCode.append(container);

        // Add a button to save each QR code to Google Drive
        const saveButton = document.createElement("button");
        saveButton.innerText = "Save to Drive";
        saveButton.addEventListener("click", function() {
            saveQRCodeToDrive(qrCode);
        });

        container.appendChild(saveButton);

        // Append the container to the body
        document.body.appendChild(container);
    }

    function saveQRCodeToDrive(qrCode) {
        const svgElement = qrCode._el.container.firstChild; // Get the SVG element from the QR code container

        if (svgElement) {
            const qrCodeSVG = new XMLSerializer().serializeToString(svgElement);

            // Send the SVG data to the server-side function
            google.script.run.withSuccessHandler(onSavedToDrive).saveQRCodeToDrive(qrCodeSVG);
        } else {
            alert("QR code not found. Please generate the QR code first.");
        }
    }

    function onSavedToDrive(filenameFromColumnB) {
        alert("QR code saved to Google Drive as " + filenameFromColumnB);
    }
</script>
</body>
</html>
